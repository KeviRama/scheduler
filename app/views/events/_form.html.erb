<% if @event.id %>
<h2>Editing event</h2>
<% else %>
<h2>New event</h2>
<% end %>
<%= form_for(@event, remote: @minimal) do |f| %>
  <div id="for_errors">
    <% if @event.errors.any? %>
      <%= render "error_msgs" %>
    <% end %>
  </div>

  <%= f.text_field :precommit_element_id,
                   :type => :hidden,
                   :readonly => true %>

  <div class="row collapse">
    <div class="small-2 columns">
      <%= f.label :description, class: "right inline" %>
    </div>
    <div class="small-10 columns">
      <%= f.text_field :body,
                       :id => "first_field",
                       :placeholder => "Please describe what is happening" %>
    </div>
  </div>
  <div class="row collapse">
    <div class="small-2 columns">
      <%= f.label :eventcategory_id, class: "right inline" %>
    </div>
    <div class="small-3 columns">
      <%= f.collection_select(:eventcategory_id,
                              @event.suitable_categories(current_user).sort,
                              :id,
                              :name,
                              { :prompt => true }) %>
    </div>
    <div class="small-2 columns">
      <%= f.label :eventsource_id, class: "right inline" %>
    </div>
    <div class="small-3 columns">
    <%= f.collection_select(:eventsource_id,
                            Eventsource.all.sort,
                            :id,
                            :name,
                            { :prompt => true }) %>
    </div>
    <div class="small-2 columns">
    </div>
  </div>
  <div class="row collapse">
    <div class="small-2 columns">
      <%= f.label :starts, class: "right inline" %>
    </div>
    <div class="small-3 columns">
      <% if current_user.can_retime?(@event) %>
        <%= f.text_field :starts_at_text,
                         :class => :datetimepicker %>
      <% else %>
        <%= f.text_field :starts_at_text,
                         :disabled => true %>
      <% end %>
    </div>
    <div class="small-2 columns">
      <%= f.label :ends, class: "right inline" %>
    </div>
    <div class="small-3 columns">
      <% if current_user.can_retime?(@event) %>
        <%= f.text_field :ends_at_text,
                         :class => :datetimepicker %>
      <% else %>
        <%= f.text_field :ends_at_text,
                         :disabled => true %>
      <% end %>
    </div>
    <div class="small-1 columns">
      <%= f.label :all_day, class: "right" %>
    </div>
    <div class="small-1 columns">
      <%= f.check_box :all_day_field %>
    </div>
  </div>
  <div class="row collapse">
    <div class="small-2 columns">
      <%= f.label :organiser, class: "right inline" %>
    </div>
    <div class="small-3 columns">
      <%= f.autocomplete_field :organiser_name,
                               autocomplete_staff_element_name_elements_path,
                               :id_element => '#event_organiser_id',
                               :placeholder => "Name of organiser (optional)",
                               "data-auto-focus" => true %>
      <%= f.text_field :organiser_id, :type => :hidden %>
    </div>
    <div class="small-2 columns">
      <%= f.label :reference, class: "right inline" %>
    </div>
    <div class="small-5 columns">
      <%= f.text_field :organiser_ref,
                       :placeholder => "additional information (optional)" %>
    </div>
  </div>
  <div class="row">
    <div class="small-9 small-offset-3 columns">
      <%= f.submit %>
    </div>
  </div>
<% end %>
<br/>
<% if @event.id %>
  <%= form_for(@commitment, remote: true) do |f| %>
    <%= f.autocomplete_field :element_name,
                             autocomplete_element_name_elements_path,
                             'data-auto-focus' => true,
                             :id_element => '#commitment_element_id',
                             :placeholder => "Type the name of a resource to add" %>
    <%= f.text_field :element_id, :type => :hidden %>
    <%= f.text_field :event_id, :type => :hidden %>
  <% end %>
  <div id="event_resources">
    <%= render partial: "resource", object: @event, locals: {editing: true} %>
  </div>
  <hr width="100%"></hr>
  <%= link_to "Delete event entirely",
              @event,
              remote: @minimal,
              method: :delete,
              data: {
                confirm: "Are you sure you want to delete #{@event.body}?"
              } %>
  <div style="min-height: 18px;">
    <span id="clone_button"><%= link_to "Clone event", clone_event_path(@event), remote: @minimal, method: :post %></span>
    <span id="cloned_message" style="display: none; color: red;">Cloned</span>
  </div>
<% else %>
  <p>Save the event in order to allow resources to be added.</p>
<% end %>
<% if known_user? %>
<small>
<div id="meta_data">
  Source id: <%= @event.source_id %> Event id: <%= @event.id %>
  Owner: <%= @event.owner_id ? @event.owner.name : "System" %>
  Created: <%= @event.created_at_text %>
  Updated: <%= @event.updated_at_text %>
</div>
</small>
<% end %>

