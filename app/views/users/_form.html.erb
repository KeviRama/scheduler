<%= form_for(@user, remote: @minimal) do |f| %>
  <% if @user.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@user.errors.count, "error") %> prohibited this user from being saved:</h2>

      <ul>
      <% @user.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="row">
    <div class="small-12 medium-6 large-4 columns">
      <label>Name</label>
      <%= f.text_field :name, :disabled => !current_user.admin %>
    </div>
    <div class="small-12 medium-6 large-4 columns">
      <label>E-mail</label>
      <%= f.text_field :email, :disabled => !current_user.admin %>
    </div>
    <div class="small-12 medium-6 large-4 columns">
      <label>Start week on</label>
      <%= f.collection_select(:firstday,
                              @user.list_days,
                              :id,
                              :name) %>
    </div>
    <div class="small-12 medium-6 large-4 columns">
      <label>Colour for own events</label>
      <div class="concern-block">
        <div class="concern-button" id="<%= @minimal ? "dynamic_colour_sample" : "colour-sample" %>" style="background-color:<%= @user.colour_not_involved %>">
          <span class="concern-spacer"></span>
          <div class="concern-text">My events</div>
        </div>
        <span style="float: right">
          <%= f.hidden_field :colour_not_involved,
            :id => @minimal ? :dynamic_colour_picker : :colour_picker,
            "data-default-colour" => "#254117" %>
        </span>
      </div>
    </div>

<% if current_user.editor || current_user.admin %>
    <div class="small-12 medium-6 large-3 columns">
      <label>Preferred event category</label>
      <%= f.collection_select(:preferred_event_category_id,
                              Eventcategory.categories_for(current_user),
                              :id,
                              :name,
                              {:include_blank => "--None--"}) %>
    </div>
    <div class="small-12 medium-8 large-5 columns">
      <label>Default event description</label>
      <%= f.text_field(:default_event_text) %>
    </div>
<% end %>
  </div>

<% if current_user.admin %>

<div class="row">
  <%= flag_group(f, 12, 6, "Permissions",
                 [
                   {field: :admin,
                    annotation: "Is this user a system administrator?",
                    disabled: current_user == @user },
                   {field: :editor,
                    prompt: "Events",
                    annotation: "Can this user create his or her own events?"},
                   {field: :edit_all_events,
                    prompt: "Edit all",
                    annotation: "Can this user edit all events in the system?"},
                   {field: :subedit_all_events,
                    prompt: "Subedit all",
                    annotation: "Can this user sub-edit all events in the system?"},
                   {field: :privileged,
                    annotation: "Can this user put events into the privileged event categories?"},
                   {field: :can_has_groups,
                    prompt: "Groups",
                    annotation: "Can this user create and edit groups?"},
                   {field: :public_groups,
                    prompt: "Public",
                    annotation: "Can this user create publicly visible groups?"},
                   {field: :can_find_free,
                    prompt: "Find free",
                    annotation: "Can this user do searches for free resources?"},
                   {field: :can_add_concerns,
                    prompt: "Adjust view",
                    annotation: "Can this user add and remove resources from his calendar view?"},
                   {field: :can_su,
                    annotation: "Can this user become another user?"},
                   {field: :can_roam,
                    annotation: "Can this user follow links from one displayed element to another?"}
                 ]) %>
  <%= flag_group(f, 12, 6, "Information",
                 [
                   {field: :arranges_cover,
                    prompt: "Cover",
                    annotation: "Does this user administer cover?"},
                   {field: :secretary,
                    annotation: "Does this user enter events on behalf of other people? Causes the Owner field in new events to be left blank."}
                 ]) %>
</div>

<% end %>
<div class="row">
<% if current_user.admin || current_user.element_owner %>
  <%= flag_group(f, 12, 6, "Resource request notifications",
                 [
                   {field: :email_notification,
                    prompt: "Daily",
                    annotation: "Should the system send daily e-mail notifications of pending requests?"},
                   {field: :immediate_notification,
                    prompt: "Immediate",
                    annotation: "Should the system send immediate e-mail notifications of resource requests?"}
                 ]) %>
<% end %>
<% if current_user.admin || current_user.staff? %>
  <%= flag_group(f, 12, 6, "Clash notifications",
                 [
                   {field: :clash_weekly,
                    prompt: "Weekly",
                    annotation: "Should the system send a weekly summary of instances where students are expected to miss your lessons?"},
                   {field: :clash_daily,
                    prompt: "Daily",
                    annotation: "Should the system send a daily summary of instances where students are expected to miss your lessons?"},
                   {field: :clash_immediate,
                    prompt: "Immediate",
                    annotation: "Should the system send notifications of pupils missing your lessons as soon as they are identified?"}
                 ]) %>
  <%= flag_group(f, 12, 6, "Options",
                 [
                 {field: :unnecessary_buttons,
                  annotation: "Would you like unnecessary buttons to be included in your forms?"}

  ]) %>
<% end %>
  <div class="small-12 medium-6 columns">
    <div class="actions">
      <%= f.submit "Update", :class => "button tiny radius" %>
    </div>
  </div>
</div>

<% end %>
