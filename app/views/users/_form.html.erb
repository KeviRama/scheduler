<%= form_for(@user, remote: @minimal) do |f| %>
  <% if @user.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@user.errors.count, "error") %> prohibited this user from being saved:</h2>

      <ul>
      <% @user.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="row">
    <div class="small-12 medium-6 large-4 columns">
      <label>Name</label>
      <%= f.text_field :name, :disabled => !current_user.admin %>
    </div>
    <div class="small-12 medium-6 large-4 columns">
      <label>E-mail</label>
      <%= f.text_field :email, :disabled => !current_user.admin %>
    </div>
    <div class="small-12 medium-6 large-4 columns">
      <label>Start week on</label>
      <%= f.collection_select(:firstday,
                              @user.list_days,
                              :id,
                              :name) %>
    </div>
    <div class="small-12 medium-6 large-4 columns">
      <label>Colour for own events</label>
      <div class="concern-block">
        <div class="concern-button" id="<%= @minimal ? "dynamic_colour_sample" : "colour-sample" %>" style="background-color:<%= @user.colour_not_involved %>">
          <span class="concern-spacer"></span>
          <div class="concern-text">My events</div>
        </div>
        <span style="float: right">
          <%= f.hidden_field :colour_not_involved,
            :id => @minimal ? :dynamic_colour_picker : :colour_picker,
            "data-default-colour" => "#254117" %>
        </span>
      </div>
    </div>

<% if current_user.editor || current_user.admin %>
    <div class="small-12 medium-6 large-3 columns">
      <label>Preferred event category</label>
      <%= f.collection_select(:preferred_event_category_id,
                              Eventcategory.categories_for(current_user),
                              :id,
                              :name,
                              {:include_blank => "--None--"}) %>
    </div>
    <div class="small-12 medium-8 large-5 columns">
      <label>Default event description</label>
      <%= f.text_field(:default_event_text) %>
    </div>
<% end %>
  </div>

<div class="row">
<% if current_user.admin %>

  <%= flag_group(f, 12, 6, "Permissions",
                 [
                   {field: :admin,
                    disabled: current_user == @user },
                   {field: :editor, prompt: "Events"},
                   {field: :edit_all_events, prompt: "Edit all"},
                   {field: :subedit_all_events, prompt: "Subedit all"},
                   {field: :privileged},
                   {field: :can_has_groups, prompt: "Groups"},
                   {field: :public_groups, prompt: "Public"},
                   {field: :can_find_free, prompt: "Find free"},
                   {field: :can_add_concerns, prompt: "Adjust view"},
                   {field: :can_su},
                   {field: :can_roam}
                 ]) %>
  <%= flag_group(f, 12, 6, "Information",
                 [
                   {field: :arranges_cover,
                    prompt: "Cover",
                    annotation: "Does this user administer cover?"},
                   {field: :secretary,
                    annotation: "Does this user enter events on behalf of other people? Causes the Owner field in new events to be left blank."}
                 ]) %>

<% else %>
  <div class="small-12 medium-6 columns">
  </div>
<% end %>
<% if current_user.admin || current_user.element_owner %>
  <%= flag_group(f, 12, 6, "Resource request notifications",
                 [
                   {field: :email_notification,
                    prompt: "Daily",
                    annotation: "Should the system send daily e-mail notifications of pending requests?"},
                   {field: :immediate_notification,
                    prompt: "Immediate",
                    annotation: "Should the system send immediate e-mail notifications of resource requests?"}
                 ]) %>
<% end %>
<% if current_user.admin || current_user.staff? %>
  <%= flag_group(f, 12, 6, "Clash notifications",
                 [
                   {field: :clash_weekly,
                    prompt: "Weekly",
                    annotation: "Should the system send a weekly summary of instances where students are expected to miss your lessons?"},
                   {field: :clash_daily,
                    prompt: "Daily",
                    annotation: "Should the system send a daily summary of instances where students are expected to miss your lessons?"},
                   {field: :clash_immediate,
                    prompt: "Immediate",
                    annotation: "Should the system send notifications of pupils missing your lessons as soon as they are identified?"}
                 ]) %>
  <% end %>
</div>
<div class="row collapse">
  <div class="small-4 columns">
    <%=
      if current_user.admin && !@minimal
        link_to "Back to list",
          users_path({user_id: @user.id}),
          class: "button tiny"
      else
        ""
      end
      %>
  </div>
  <div class="small-4 columns">
    <% if current_user.can_su && !@minimal && current_user.id != @user.id %>
      <div align="center">
         <%= link_to 'su', become_path(@user), :method => :put, class: "tiny button radius" %>
      </div>
    <% end %>
  </div>
  <div class="small-4 columns">
    <div class="actions" align="right">
      <%= f.submit "Update", :class => "button tiny radius" %>
    </div>
  </div>
</div>

<% end %>
