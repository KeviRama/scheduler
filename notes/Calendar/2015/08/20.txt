Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2015-08-20T12:21:43+01:00

====== Thursday 20 Aug 2015 ======

I realised this morning that event categories really need a "visible" flag (default true) so that I can have silent gaps in the people's schedules.  Since I need to attach the students to the gaps, they would otherwise appear in their web display.

Today I aim to:

[*] Add visible flag
[*] Tidy processing of Hiatuses further
[*] Allow Gaps (hard) and Suspensions (soft) through the web i/f
[*] Take account of year groups when storing gaps and suspensions

Golly - it seems to work (after a few false starts).  The big test now would be to take a fresh copy of the live database, plus today's data, edit in the start-of-term messing about, then load and see if we can suspend the right lessons.

Try it.  Need to add the Hidden eventcategory, and the Suspension property after running rake db:migrate.

Just hit a little oddity in the current database.  Nick has added in the Other Half briefing events, and correctly used the right groups (e.g. "Morgan's House 3rd year") to populate them.  As they stand though, they don't appear on the corresponding pupils' timetables.  If however I remove and re-add those groups then they do.  That seems a little odd.

Re-import the live d/b and try following the logic manually.  Could there be an old group of the same name?  My intention was that the same groups should be moved to a new era.

(In typical SB style, the Lower School Study Hall is there twice LSStudy and LSSH.  Need to merge, and give it a sensible name.)

My test pupil is Archie Bermingham who is in James's House.  Hang on a minute.  Test another pupil who hasn't had his house name changed under him.  It's fine for Edward Bury in Cotton's.  The problem is just that Nick has used slightly out of date house names.  Just correct the entry.  A panic over nothing.  Return to entering the day's activities.

All seems to be going smoothly.  I am suspending the lessons rather than imposing a gap, so we can see what isn't there.

Well, it all seems to work, but I do seem to have modified a surprising number of files.  Time for a little rest, and then I'll think about committing it all and doing the same on the live system.

Can I make a group called "Non-tutors" consisting of all the teaching staff, except the tutors?

Interesting

164 teachers
81 tutors
84 in my group

There must be a tutor who isn't a teacher.  It's not quite working.  It shows up for all teachers, without the exclusion.  How about an ical feed (which works a different way).  Yes, they seem to work correctly.  Neat.

Now the display uses events_on, whilst the calendar uses commitments_on.  I believe the latter is potentially better overall, so can I layer events_on on top of it?  Ah, the events_on in the event model doesn't do recursion at all - it expects you to already know which resources you are interested in.  The recursion happens in the element model, and that appears merely to look at inclusions - it ignores exclusions.  I believe the commitments model does it better - doesn't try to fish into the data structures itself.

Need to tidy up those broken locations too.  Both are used in SB - one for tutor periods and the other for activities.  I need to merge both into one location, and give it all the other's commitments.  I don't suppose they belong to groups.  No, neither of them.

Merge the locations into one.  Delete the other and make its location alias point to the one we still have.

Today:

[ ] Commit my changes


Tomorrow:

[ ] Test code again with latest data
[ ] Promote to live system
[ ] Edit in start-of-term events
[ ] Run import again
[ ] Merge two locations
[ ] Implement an alternative events_on in element.rb and test the two for speed in the real app
