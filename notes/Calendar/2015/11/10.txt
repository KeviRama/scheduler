Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2015-11-10T08:51:00+00:00

====== Tuesday 10 Nov 2015 ======

Today's objective is to import tag groups from SB, because I think people could find them very useful.

This will call for a new group type TagGroup, which stores the source id from SB.  Then I will need to modify the loading code to bring them across.  I already export the necessary files.

Users will not be able to edit their tag groups on Scheduler, since they are maintained on SB.  They will however be able to build on them or clone them (in which case the clone will be a VanillaGroup).  SB defaults to them being public, but I will make them all private (which is much more sensible).  Users with permission to create public groups will be able to modify them and make them public.  Once made public, the loader won't alter that status.

I've got two tag groups of my own called "Computing project" and "Jamesian Tag Group".  They'll do nicely for testing.

Ah - here's an issue.  Tag groups on SB belong to a teacher.  Groups on Scheduler belong to a user.  It will therefore be possible to import them only if the relevant teacher has a corresponding user account.  In the odd case of me, I will need to pick one of my user accounts.

What era should they go in?  I can put them in the current era, because it would be nice to see them get tidied up, but it if they aren't removed from SB, they're just going to reappear anyway.  I think I'll put them in the perpetual era for now.  They certainly seem to last forever on SB.

Interestingly, tag groups do seem to have an end date, but it's just a year from when they were created, so pretty meaningless.  They also get re-dated when the system rolls over to the new academic year.  Probably best ignored.

Now, I think that teaching group membership is specified by the Academic Records.  How do I merge those into my teaching groups?  Does it make sense to do Tag groups the same way?

Interesting thing to note - there seem to be a lot of taggroup membership records without corresponding pupils and/or taggroups.  Messy.  Perhaps they're for pupils who have left.  Before filtering I have 53396 and after filtering only 34327.

I seem to have completed that with almost unseemly haste.  Should I go on and do OH groups whilst I'm on a roll?  ISTR their data records are a bit more complex.

rtrwgroups seems to contain the group definitions.  And the membership?

Just to add to the fun, the groups seem to have multiple entries in the file.  "Computer Project (M8)" occurs 28 times in the file.  Possibly a fresh entry for each week?  Yes, that seems to be the case.

I suspect this is a result of Stuart's demented way of adjusting group membership over the term.  He's creating new groups each week, with the same name as the old group, and then adjusting the membership.  Given that I have much better data structures, how should I handle it?

There seems to be nothing to link together all the groups, other than their names.  Fields are:

'''
RTRWGroupsIdent,RTRotaWeekIdent,GroupIdent,GroupDay,GroupStart,GroupEnd,SCTIdent,RoomIdent,GroupRota,GroupSlotTime,StaffIdent,StaffIdent2,GroupName,DateIdent,RTGroupChecked,RTProtectedGroupClash,UserIdent3,UserIdent4
43740,663,34340,1,960,1020,13,229,0,0,358,,"Computer Project (M8)",4732,0,0,,
'''


RTRWGroupsIdent: 43740		Unique identifier, but different for each instance
RTRotaWeekIdent: 663			Points to a week record, which specifies the start date.
GroupIdent: 34340			Ah!  Perhaps this ties them together.

Yes, I believe it does.  It refers to the group.csv file, whence I get my normal teaching groups.  How am I filtering out the OH groups when I process that file.  They're not making it as far as the data dump, so something is filtering them out.  What?

Follow this particular one through to see where it is filtered.

Ah - all the OH groups seem to have a year_ident of -10.  That will limit things somewhat.  And the curriculum ident for 34340?  5534.  That too has a year ident of -10.  There seems to be some nasty frigging going on here.

OH Groups are in the groups table, but with a year ident of -10.  They refer to an entry in the curriculum table which also has a year ident of -10.  Both of them thus get discarded, since there is no year in the year table with an ident of -10.

Where then do the membership records happen?  Take Hayden Ramm for instance.  He is a member of my Computing Project group.  Is that recorded through an Academic Record or through the rtrw stuff?  Hayden is student_id 4150.  There does seem to be a record in the rtrwpupils file which links the two together.

I think I'm going to need to treat them as separate from the SB_Groups.  Where two groups share the same GroupIdent (even though I don't have the group record) I take the later one chronologically.  Then take the student records which match those particular RTRWGroups (and not the earlier ones).  However, I then treat them as being a single group which varies over time.

Thus for the above record, I treat 34340 as the source_id, to give continuity from week to week, but I treat 43740 as the indicator for membership, so I pick up a varying membership over time.  Very messy.

Hang on - I'm already reading in the rtrwgroups file.  What am I using it for?  It also tells me when other half should be happening.  In other words, it gives me both the times and the names of the groups.  The rtrwpupils records then link directly to these records, rather than via group records.

Very, very messy.  I need to tidy it up.

The most interesting part is going to be going through all the records from rtrwgroups, picking out the most recent by date for each group_id, and creating a group based on the membership of that particular instance.
