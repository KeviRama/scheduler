Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2015-11-03T10:45:49+00:00

====== Tuesday 03 Nov 2015 ======

I've done a fair bit of talking to people and my plan seems to be generally accepted.  DJD has particular requirements which I'm going to try to meet.  I've also collated a list of what I think needs to be done before we can start using this and put it in Wunderlist.  Now I just need to work through that list.

Today, I think I'll start with the count of pending approvals (ignore ones in the past) and drag-n-drop circumventing permissions.

Looking at the code for the pending approvals count, I think I'm currently counting the wrong thing.  I suspect I'm counting all the pending commitments.  No - if I try it out I don't seem to be, but I'm not sure why not.  For the concern, my line is:

'''
self.element.commitments.tentative.not_rejected.count
'''

Ah yes - I'm looking specifically at my own element, and then counting all the tentative commitments.  I really need to put a further filter on that to find only future ones.  That will mean a join with the events.  Managed to do it!  My activerecord-fu is improving.

Now the drag-and-drop bit.  That just needs the same logic as the existing explicit adding of commitments.

After that, I'll do the selective shading.  It's confusing as it currently stands.  My thoughts are:

Can perhaps use shading in two different ways.  If you are seeing the event via a resource which you own (i.e. you are in a position to grant or refuse permission) then it appears shaded if permission has not been granted. (Red tinge if refused?). If you do not own the resource (which implies therefore that the resource has been approved, otherwise you wouldn't see it at all) then shading indicates that the event is incomplete.

Note that if you are viewing the event via a different resource, which you do not own, then the event should still be greyed out if it's incomplete.  The route by which you're getting to the event matters.

Done that now too.  What next?  Should logged-in users be able to search for incomplete events?  I'm going to say no for now - that can wait for a more sophisticated search function.  Changed my mind - logged in users will now see incomplete events, but flagged as incomplete.  Not-logged-in users won't see them.

Now on to the Days controller.  It retrieves events based on an element, so can take account of the individual flags in the commitments.  There are two things we can potentially take account of:

1) Is the commitment firm or tentative (or rejected?)
2) Is the event complete?

I suspect that by default I should go only for firm commitments, but provided the commitment is firm, perhaps I should still show incomplete events?  That way, once DJD has confirmed something is in the calendar, it will appear, even if the other things haven't been authorised yet.  What about flags to adjust this behaviour?  I could add a tentative flag, but does that then just add in the tentative events, or does it give me the tentative commitment, but not the firm ones.

* Default - just firm commitments
* ?tentative - just tentative commitments
* ?tentative&firm - both
* ?firm - just firm commitments.
* ?firm&tentative - same as ?tentative&firm

