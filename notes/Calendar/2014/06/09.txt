Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2014-06-09T20:42:13+01:00

====== Monday 09 Jun 2014 ======

I think I'm on the point of managing to get cover and/or invigilations out of SB.

The crucial table is StaffCovers, although it's a view rather than a native table.  It seems to contain a row for each instance of someone covering a lesson or doing an invigilation.  Interesting fields are:

StaffAbLineIdent		integer	References StaffAbLine table
AbsenceDate			integer	References Days table
UserIdent			integer	References Staff table.  Row for teacher doing cover.
Staff				string	Name of teacher *doing* the cover
PType				integer	60 for our teachers.  40 for prep school.


Note that the data are seriously un-normalized.  If you have the UserIdent you don't need the staff member's name as well, nor the PType.  This table tells us that someone is doing a cover, but not what or when.  For that we go first to the StaffAbLine table.

Useful fields in that:

StaffAbLineIdent		integer	Row identifier.  Seems to refer to an instance of absence.
StaffAbIdent			integer	References StaffAbsence table
StaffAbsenceDate		integer	References Days table
Period				integer	The period to be covered.  References Period table.
StaffAbCoverNeed		boolean	I think.  Cover needed?
UserIdent			integer	References Staff table.  Teacher needing cover?  No, seems
							to be covering teacher again.
RoomIdent			integer	References Room table, but seems to be usually blank
Notes				string	Description of reason.  Contains sensitive information
TimetableIdent		integer	Which lesson from the timetable needs cover


So what's in the StaffAbsence table?  Interestingly, every row in that table contains the string "Invigilation" in the InvigName field.  Perhaps extra information for invigilation?

StaffAbIdent			integer	Identifies the row
StaffAbsenceDate		integer	References Days table (again)
Period				integer	References Periods table.
StaffAbsenceDate2	integer	A second date.  Not always the same. (?)
Period2				integer	A second period.  Likewise.
UserIdent			integer	Back to the Staff table.  Not sure who it references.  Covered teacher?

It seems to me that there's enough there to reconstruct things.  Let's amend my code to grab those tables, but not the Notes from the StaffAbLine table.:q


