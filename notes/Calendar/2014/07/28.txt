Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2014-07-28T08:10:11+01:00

====== Monday 28 Jul 2014 ======

Just had an idea - AutoGroups - a batch job that runs regularly (daily?) and creates and maintains various scripted groups.

All staff (by current flag)
All tutors per house
All students per house
All students per year
All students

and doubtless I can think of more.  These would have to have some kind of ownership to distinguish them from other groups.  Or could they be identified by Persona?  I'm inclined to think that Persona is orthogonal to source or ownership, but it needs a little thought.

It occurs to me to let Groups have no persona at all.  This would be a vanilla group.  It wouldn't need an additional database record, but it might make sense for it appear to have a persona from the point of view of some client code.

To select groups belonging to a particular user, one needs a long chain of joins.

Group <= Element <= Ownership => User

can this all be expressed in a Rails selection criterion thingy?  A scope, that's it.

Yes it can - wow!

Just realised I need to enhance "events_on" in the element model to take account of memberships varying by date.  When checking for memberships, one needs to take account of their validity dates and select only those active on the specified date.  This may mean fetching things one day at a time when a range is specified, which will slow things up a bit.  Month view could get quite slow.

A thought.  When selecting events for a potentially grouped object for a longish period (e.g. a whole month) one could first select all groups for which the element is a member (or hereditary member) anywhere in the month.  If those memberships last the whole month (or whatever period it is) then one can go for a simpler processing path (which will in general be the norm), and use a fixed set of groups to gather events for the whole month.  Only if any variation occurs will one have to establish separate date ranges and handle them separately.

For a full month, given perhaps 5 resources to look at, one could end up doing 155 (31 * 5) event queries.  With this processing, that would usually be reduced to just 5, and indeed we can further optimise things by allowing events_on to take a range of resources - that way it comes down to a single database hit.  Nice.
