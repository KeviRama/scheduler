Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2014-07-20T09:27:11+01:00

====== Sunday 20 Jul 2014 ======

Thinking about moving "current" and "era_id" from Teaching/Tutor group records into the actual Group record, I realise that there's a bit of a trade-off.  Although it moves the "current" flag closer to the membership record, it moves it further from the parental "Element" record.  I probably want to duplicate it in the element record (although it probably could be accessed by a join), but even so, it suggests that the structure is still wrong.  I'm drawn again to turning things around and just having Groups, with some additional records hiding behind them for extra information.

Can I, from a Ruby Class, discover what instance methods and instance will provide before it is instantiated?  Yes, it seems you can call method_defined? on the class.  Will this work even with something dynamically generated by Rails?  Yes, it seems it does.

All the components which I need seem to be there.  It's quite a big change, and I may lose data en route, but I think it's worth at least trying.

My plan currently is to send all my current changes to live, thus stopping the Alex Taylor problem.  Make sure all that works, then take a copy of the live database for home.  I'll then try to convert that without data loss, taking several stages to move things over, and provided all is well I'll send the same data back to the live system along with the new code.  If I fail in the data conversion, I will simply re-load the data from scratch and lose everything from the previous academic year.

It would be worth tagging way-points in Git so that I can potentially repeat the process if required.  Need to remind myself how to do that.

Steps to get all my current changes on to the live system.

[*] Download latest data files to my test system
[*] Refresh my d/b from the live dump from Fri (18/7)
[*] Run the era.fix_all_groups method
[*] Load the latest data files - check for issues.
[ ] Check in the latest code and send to nimbus
[ ] Dump live d/b
[ ] Latest code to live system
[ ] Restart live system
[ ] export RAILS_ENV=production
[ ] Run era.fix_all_groups
[ ] Do a test run with latest data (which should do nothing).

