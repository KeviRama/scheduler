Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2014-07-23T08:51:13+01:00

====== Wednesday 23 Jul 2014 ======

Objectives for today.

[*] Promote what I've done to the live system (copying data back there).
[ ] My test suite is now totally FUBARed.  Fix it.
[*] Deleting a member of staff should delete his tutor groups and their groups.
[ ] When a teaching group changes its name, any events derived from it might change too.
[ ] Get the program to show how many groups each pupil *will* be in.
[ ] Element records should inherit the current flag from their entities (for speed of searching)


And the individual stages for getting what I've done back to the live system are:

[*] Check in all my current source and add a tag
[*] Send to live system
[*] Dump database on dev
[*] Send to live system
[*] Stop web server (and app) on Mach2
[*] Dump live database
[*] Import new code
[*] Load new database contents
[*] Start up again

Sounds too easy - I've probably missed something.

On to the issue of deleting a member of staff and getting his complete tutor group to go.  Not that I ever intend to delete a member of staff, but it should work just because it should.  What is the current state of affairs?

It may be possible to use a has_many, through, dependent=> destroy relationship.

I am staff id 2146.  I have two tutorgrouppersonae, with ids 246 and 402, pointing to groups 6361 and 11019 respectively.  What happens if I delete me?  A whole lot of commitments were deleted, plus two ownerships (why two?), plus an element, and two tutorgrouppersonae.  Not apparently though the relevant groups.  Test.  Yes, the group has indeed been left with no persona - how terrible.  Reload the d/b and try again.

Interesting - I seem to have two duplicate ownership records for exactly the same relationship.  One was created on 27/6/2014 and the other on 18/7/2014.  I wonder how that happened?  Silly error in my code - I'm creating the ownership record regardless, each time the user record is saved, and not bothering to check whether it's already there.  Because I updated my user record by setting the "admin" flag, I gained a second ownership record.  Just need to get rid of that and fix my code.  Done.

Now, can I cause the deletion of a staff record to delete not the persona, but the underlying group (thus causing the persona to go too)?  Eventually achieved it by putting an explicit after_destroy method in the staff model.  Good.
