Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2014-05-18T12:08:18+01:00

====== Sunday 18 May 2014 ======

Been tidying up my date processing and adding some validation.  A couple of small wrinkles in the input file have come to light.

'''
"Rugby: Touchliners Leaving Dinner, CMR/Dining Hall","2013-12-7","7:00:00 PM","","12:00:00 AM","False","",""
"Hockey Club Dinner and Awards Evening","2014-3-22","7:00:00 PM","","12:00:00 AM","False","",""
'''

The issue would seem to be in the interpretation of "12:00:00 AM".  Historically that would have meant noon, but more recently it has come to mean midnight.  Clearly the generating program takes it to mean midnight, but how is the Rails/Ruby code interpreting it?

Since the end date is empty, I am executing:

Time.zone.parse("2014-3-22 12:00:00 AM")

Ah - it's interpreting it as midnight, but midnight at the start of the 22nd.  Hence the problem.  The supplying program is being inconsistent - if it's 12 AM, then the date is different too.  I will need some special case code to handle this.  Done.

I think it's probably time I moved my d/b to MySql - I suspect it would be faster for the kind of mass data loading which I'm doing.  I could perhaps test it on this computer.  Mach2 is comparatively very slow.

How long does a complete purge and re-load currently take on Midnight, using Sqlite3?  About 14 seconds.  That's running on an SSD.  And if I switch to MySql?  5 seconds.  Sounds worthwhile to me.

Here's an oddity - I have no events in the week from the 15th to the 21st of June (or for several weeks afterwards).  Why?  It's all to do with encoding, and seems to be an effect of switching to MySql.  As far as I can make out, everything should default to utf-8, but that doesn't quite seem to be happening.

Finally found a magic incantation which seems to work and am using it to convert all my event descriptions at the point of entry.

    ''@description = description.encode("utf-8", ''
''                                  "binary", ''
''                                  :invalid => :replace, ''
''                                  :undef => :replace,''
''                                  :replace => "")''

And I seem to have my events back.  Also set MySql to use utf-8 explicitly.
