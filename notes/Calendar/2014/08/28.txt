Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2014-08-28T06:36:34+01:00

====== Thursday 28 Aug 2014 ======

Just noticed two interesting things:

1. When the user isn't logged in, navigating through FullCalendar doesn't change the date on the little calendar.
2. The system ignores the EventCategory flags when deciding what to show on the not-logged-in display.

Both should be fairly simple (famous last words.)

Done and deployed.

Something horrible has happened on my live system.  I just did a fresh data fetch from SB, and ran the loader script, intending merely to recreate the .yml files with an extra subject in.  Unfortunately the loader program crashed, which it hasn't done in quite a while.  Need to work out why.

Sucked the data files down to my test system and I get exactly the same result.  It happens in app/models/pupil.rb line 62.

'''
/home/john/Work/Coding/scheduler/app/models/pupil.rb:62:in `tutorgroups': undefined method `tutorgroups' for []:Array (NoMethodError)
	from /home/john/Work/Coding/scheduler/app/models/pupil.rb:38:in `element_name'
	from /home/john/Work/Coding/scheduler/app/models/concerns/elemental.rb:57:in `update_element'
'''


I think it's because the pupil does not at that point have an element record and so, contrary to my comment in the code, the "groups" method which it's calling does return an array - an empty one.

Ah - I've created a deadly embrace when adding a new pupil.  In order to create the element record I need an element name, and the element name includes the pupil's tutor group, so I go and try to access the tutor group record, which means accessing the element record, etc.

Where is the correct place to break the deadlock?  I already have code in place to check that there is
