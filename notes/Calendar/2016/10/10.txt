Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2016-10-10T10:22:06+01:00

====== Monday 10 Oct 2016 ======

Did some good stuff over the weekend - there now remains some exhaustive tidying up and testing to do.  But first, I need to spend a bit of time checking on the status of the limited company and seeing what actions are currently required.  I need to read the on-line guidance again and check what I haven't yet done.

OK - done that.  I seem to be at a decision point.  Abingdon are dithering over our proposed contract and it might go either way.  If they decide not to go with it, I will declare the company dormant and just concentrate on my coding.  If they do go ahead, I will declare it as trading and set dates etc.  Need to wait until after my meeting with Niki on Monday to progress.

Back then to coding.  I think it would be good to add the display of teaching groups to teachers.  I think the links are there.

Rather interesting trying to use the linkage to get directly from teachers to teaching groups.  I can do it mechanically, but it would be nice to have a proper scope which does it in a single d/b hit.

I also have an ongoing problem with iSAMS's faulty API.  Because they don't provide details of teaching groups taught by form, I have linked the lessons directly to the tutor groups.  It causes steadily more problems.  I think I will need to go back and create the missing groups.

Now - how can I get these to link up correctly.  I would like a scope which lets you find all a teacher's teaching groups.  Yes, I can do it with:

''Staff.teachinggrouppersonae.collect {|tgp| tgp.group}''

but that's clunky.  I'd like a scope on either the staff or group which lets me find them.  This will involve a bit of joining-fu.  It appears that the code which I've already put in group.rb is actually wrong and doesn't work.  Need to fix that first.

Now seem to have got that to work.  Can I come up with something to link staff to their teaching groups all in one go.  Yes, and it's incredibly simple.  I can put:

''has_many :groups, :through => :teachinggrouppersonae''

in my Staff model and it Just Works(TM).  Wow!.  Need to change the name though.  This clashes with the existing groups() method provided by the elemental module.

Not quite clear how to do it though.  Perhaps it's source: or source_type:

And the final version is:

''has_many :teachinggroups, through: :teachinggrouppersonae, source: :group'' 

Excellent.

Actually, it has led to one slight confusion.  Pupils too have a teachinggroups() method, but this produces a list of the teaching groups of which they currently are members.  A slightly different meaning.  This new group is meant to list the groups which the member of staff teaches.  Perhaps we should rename it as groupstaught().  Yes, that's better.

Historical group membership should be broken up by era.  All groups belong to an era.

I feel I've got a lot of bits out on the floor to play with, but I'm not yet sure how best to fit them together.  I might want to nest the display elements to get the best results.

Just worked out something which has been troubling me.  I tried to push my feature/owned-locations branch to the origin and it wouldn't let me, saying my copy was lacking changes on the origin.  This baffled me because it definitely isn't.  I've now worked out why.

I've done something which I've read in the past was a no-no, but I hadn't fully appreciated the problem - and I didn't realise I was doing it.

I created this branch by branching from develop, and I must have pushed it to the origin at some point in my work.  Then I left it for a while, and when I resurrected it I wanted to bring it up to date with development work which I had done between-times.  I was faced with a choice between "git merge develop" and "git rebase develop" and having read up on them I went for the re-base.

And the rule is - don't rebase a branch which you have pushed anywhere else.  They then seem to be two unconnected branches and you can't push again later.  I need now to disentangle this.  Probably best done from a different machine so I can't possibly accidentally delete this local branch.
