Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2016-10-05T08:49:46+01:00

====== Wednesday 05 Oct 2016 ======

Realized I could do with some extra d/b records in Scheduler in order to display all the information which I want.

Proposing to add:

* Subjects
* Field linking teaching groups to subjects
* Field in teaching groups for year
* Records linking subjects to staff (HABTM)
* Records linking teaching groups to subjects (HABTM)

Am I sure I can populate all of this from the iSAMS data?  Pretty sure.  Some will need constructing, but all the basic information is there, with the big exception of the broken bit of iSAMS's timetable feed.

Ah - hang on a minute.  One problem.  Because of iSAMS's broken feed, many of my lower school lessons are linked not to teaching groups but to tutor groups.  These can't have that information, because it doesn't make any sense.  I can leave things as they are for now, or I could artificially create the missing groups.

I'm inclined to leave things alone for now.  I could create the groups, but I don't think I will until it's needed.  They would be fairly simple, because the membership of, say, 1M Ma, could simply be 1M.  It's just another layer of indirection, but would then give us the necessary fields to store subject etc.  Put it on the back burner.

I think it would be a good idea to stash the work which I've done so far and then start a separate development branch to introduce the subject records.  Only once those are proven will I merge that branch with this one.

What fields does my subject record need?  Just a name?  Perhaps yes.  No, it needs datasource_id and source_id as well.

OK - created.  Can I populate it?

[*] Subjects loading
[*] Subjects linked to teaching groups
[*] Subjects linked to staff
[*] Teaching groups linked to staff


Two things to test.

[*] If I find the same ActiveRecord by two different means, are they the same record?  Yes.
[*] It seems ActiveRecord will actually create and delete linking records in an optimised way if I simply assign an array to a record.  Test this, especially deletion.

Certainly, assigning an array of three staff to my subject.staffs record does seem to create three linking records.  Now let's assign 4, 2 of them the same and 2 new.  And that seems to work too.  Hunky.  I might be able to do the assignment of staff to a subject very quickly.  Done.
