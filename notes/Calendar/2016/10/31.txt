Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2016-10-31T13:44:42+00:00

====== Monday 31 Oct 2016 ======

In late testing of Friday's release I noticed a problem which isn't new, but hadn't previously been apparent.

iSAMS does something slightly odd, in that when a pupil leaves it doesn't remove him from his teaching sets etc.  You thus end up getting data down which is inconsistent - the set lists include pupils who are no longer present in the files.

I had previously fixed my code so it didn't complain about this too much, but I've now realised that the order of events means they end up not being removed from the sets in Scheduler.  Had they first been removed from the sets, then deleted, then all would be well.  Because it happens the other way around, it isn't.

I need to fix the code to cope with this strangeness correctly.  Ideally I think I may well change the group membership code in the loader entirely - it currently strikes me as slightly odd, because it uses the source system's id as an identifier, instead of using the element id which would be completely unambiguous.

Start with a list of pupils whom this affects.

69		Olivier-Philippe Kalafatis
97		Louis Ashcroft
98		Lukas Ehlers
2483	Harry Brown
5948	Samuel Toft
12545	Emile Bourgett
15137	Satoshi Yoshida

I've already checked and all of these are correctly marked as being non longer current.

Let's re-write the membership code to work in a better way, and check that exactly these ones get removed from sets.  Keep the database, and the current log file for reference.

New code seems to work.  Check it's idempotent.  Seems to be.

Download latest data files and make sure it copes with those too.
