Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2016-10-02T09:13:48+01:00

====== Sunday 02 Oct 2016 ======

An interesting new problem cropped up yesterday.  I noticed it because Ian had set Helen Whitworth to do a cover and it failed to load.  I set out to discover why.

The first thing I noticed was that there are two Helen Whitworths!  Helen Whitworth seems to be a member of the ancillary staff, whilst Helen K Whitworth is an RS teacher.  It was the latter whom ICF wanted.  My first thought was there was some sort of cross-threading (which certainly shouldn't happen, because they are not identified by name) but this turned out to be a red herring.

The real explanation is that Helen K Whitworth's record was initially added to iSAMS with no e-mail address.  This led to here being added to Scheduler with active set to false.  The loader takes a very conservative view and never changes the active flag after a record has been created.  On further investigation, there were about 8 others in a similar position, although mostly peripatetic drama teachers and people from SHSK.

To add to the confusion, it seems that Helen K Whitworth was also added to SchoolBase before it went away, but also in an incomplete way.  She seems to have been added independently to iSAMS, because her record there has no previous_mis_id field.  And she was added as Helen Whitworthe to SchoolBase, meaning she has in total 3 staff records in Scheduler, two spurious, and one correct but lacking the active flag.

Helen K Whitworth has logged in to Scheduler about 2 weeks ago, but failed to get a proper display because her staff record wasn't set up.  There are two ways to cure this - either delete her user record and let her try again, or set up the right connection and privileges manually.

I have now modified the loader utility so it will be just a tad more generous.  If a staff record has active set to false, it will now change it to true, although it won't do it the other way around.  Arguably I should delete the spurious Helen Whitworth staff records too.  The test is to ensure first that they have no commitments and no memberships.

Helen Whitworthe is not active, and thus can't have any such thing.  Her datasource_id is 1 (SchoolBase) so she can go.  Arguably, any inactive staff record with a datasource_id of 1 can go - they exist only to stop them coming in from SB again, and SB is now gone.  There are 71 of them!  Tried deleting them on my test system.  Now how about the other Helen Whitworth from SB.  She is active, but not current.  Therefore need to check her element record.  She has 2 memberships and no commitments.  She was a member of All staff and Teaching staff.  Both have ended.  Delete her too.

What about her user account?  Just delete that.

Ready I think to another tiny release.
