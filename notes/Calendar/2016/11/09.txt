Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2016-11-09T08:54:18+00:00

====== Wednesday 09 Nov 2016 ======

Excellent progress yesterday.  What do I need to do now to finish off this particular development?  Once I've done that I'd like to experiment with setting up a blank system for ASH.

[*] Do some comparative checks of both schedule display and calendar download to ensure that my changes have not affected the results.
[*] Test processing for something when BST is in effect.
[*] Put together some daily and weekly batch jobs (2 daily, 1 weekly) and install them on my staging server to see how well they run.
[*] Greatly reduce the verbosity of the checker utility.

I'm just re-loading the live database on my test systems so then I'll be able to do some visual and ical comparisons to make sure events still seem to be coming out right.  The school's public calendar is the particularly sensitive item.

Neat selection for checking.

Sam Andersson (1M)
Sam Agg (3HMAB)
Sam Bell (5NP)
Sam Wilmot (7RP)
Sam Coull - staff
Sam Pullen-Campbell - staff

Checked all of those and the only difference in display which I see is the addition of the odd little red triangle - which is the whole point of this update.

Now download the calendar from both live and staging servers.  Element ID is 17424.  They will not be identical because of the date stamp on each entry, but ideally that should be the only difference.

Almost - there seem to be a few new events in the Amey Theatre since I took a copy.  Check that those have indeed been added to the live system since the small hours of this morning.  No - that does not seem to be the case.  Why the difference?  Ah - it's because DJD has approved them in the course of this morning.  They were there before, but unapproved so they didn't appear in the calendar feed.  Now they have been approved, so they do.  Excellent.

I'm a bit stuck now until my utility complete its first run.  What I'll do is create a fake lesson and a fake clashing commitment.

Sat 10th June, to avoid too much processing.  Lesson is 10:00 - 10:50.  Spurious entry is 10:20 to 10:55, so if either slips by an hour, they won't overlap.  The event in the d/b should have been stored in GMT.  Indeed it has.  Check also that all the messages are correctly formatted in BST and not GMT.

Hmmm.  It ran, but it doesn't seem to have flagged my clash.  Why not?  Start date 2017-06-10.  It's calculated an end date of 2016-11-12.  Not quite right.  That's because I'm calculating it from today's date rather than the indicated start date.  It hasn't hurt before because I've always given a start date in the current week.  Now it seems to work.  Hasn't generated an e-mail though - it should have e-mailed Dan Mason.  Will it e-mail him if I run a summary?  Yes, indeed it does.  What has gone wrong with the as-it's-entered e-mail then?

Got it - because I'm now restricting my selection of resources to just pupils, I don't find the staff when I go to look for them.

Golly - that job seems to be kind of finished.
