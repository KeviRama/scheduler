Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2016-09-30T09:56:36+01:00

====== Friday 30 Sep 2016 ======

Spent yesterday setting up all my e-mail stuff on Cumulus, and then this morning I switched the services over.  I do hope all is well.

An interesting niggle has arisen in the last couple of days.  OTL has added some tutorials which don't involve a teacher, and my script is whingeing about it a bit.  He's also added in some with a student directly attached, which currently I don't handle at all.

There's a flag in the tutorial record for each of teachers and students, but apparently this doesn't indicate whether they're there or not - just whether or not it should appear on their timetables.  A bit weird, the idea of having a tutorial but not having it appear on the affected individual's timetable.  "You have a tutorial, but we're not telling you about it".  I could honour the flag, but I do need to:

[ ] Don't whinge when there aren't any teachers
[ ] Do process student records too
[ ] Perhaps suppress entries if flag is set to 0

It would also make sense to generalize code where possible.  Currently the MIS_ScheduleEntry expects several arrays of resources to exist, but it leaves it up to sub-classes to create them.  It would be better if the parent initializer created them, and then the sub-classes populated them.  Cleaner.

I'll put aside the bits which I was working on and start a new development branch.  Happily, this new way of working should make that easy.

First I need to check what class sub-class MIS_ScheduleEntry, and if it's ever used without being sub-classed.

'''
john@knight:~/Work/Coding/scheduler/lib/import$ grep MIS_ScheduleEntry */*.rb
isams/mistimetable.rb:class ISAMS_ScheduleEntry < MIS_ScheduleEntry
isams/mistimetable.rb:class ISAMS_MeetingEntry < MIS_ScheduleEntry
isams/mistimetable.rb:class ISAMS_OtherHalfEntry < MIS_ScheduleEntry
isams/mistimetable.rb:class ISAMS_TutorialEntry < MIS_ScheduleEntry
isams/mistimetable.rb:class ISAMS_YeargroupEntry < MIS_ScheduleEntry
misimport/mistimetable.rb:class MIS_ScheduleEntry
school/mistimetable.rb:class MIS_ScheduleEntry
john@knight:~/Work/Coding/scheduler/lib/import$
'''


The final one just adds some bits for OTL's timetable dump, so the answer is no it's never used raw.  Also the one called ISAMS_ScheduleEntry should really be called ISAMS_TimetableEntry.  It was done before I realised there were going to be lots of them.  Shouldn't be difficult to rename.

Let's get the latest d/b dump and iSAMS export files and make sure we can reproduce the problem.  Yes, we can.

Start by renaming ISAMS_ScheduleEntry to ISAMS_TimetableEntry.  Done that.  Test it still runs.  It does.

Now lets put an initializer in MIS_ScheduleEntry to create the necessary arrays, and have all the others call it.  Then test that as well.  Now it fails - it thinks at least one of them doesn't exist.  Ah - in the tutorial one I called super() in the wrong place.  Now seems to work.

Next, get rid of the spurious warning message.  It seems that you can have a tutorial without a tutor!  I think that can be done just by setting the verbose flag to false on the slurp() call.

Do we ever have an instance in the data file of a staff member or pupil being associated with a tutorial, but the flag being set to 0?  I know it happens the other way around.  No - it seems there is none.  I don't think I'll bother with the flag then - it seems a little pointless.  On to adding in the pupils.

Very simple and straightforward - I do love well-structured, easy to maintain code.

Done and deployed.  Now what next.
