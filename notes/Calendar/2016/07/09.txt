Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2016-07-09T16:31:43+01:00

====== Saturday 09 Jul 2016 ======

After a bit of a gap when I was working on the SB => iSAMS data migration, I'm starting to look at the iSAMS => Scheduler data feed again.

It occurs to me that perhaps I want to be able to access timetables other than the current one.  OTL is loading various versions of the proposed new one, but they aren't flagged as current yet.  It would be interesting to try to start to set up next year.

I think I need to change the feed to get a copy of future timetables.  Yes, and I seem to have got a larger file as a result.  Take a look.

The test timetables are structured as:

'''
<TimetableManager>
  <DevelopmentTimetables>
	<Timetable Id="6">
	  <Name>Abingdon TT v0.1</Name>
'''


whilst the live one is:

'''
<TimetableManager>
  <PublishedTimetables>
	<Timetable Id="5">
	  <Name>Abingdon Test 2015/16</Name>
'''

In a parallel fashion, there are also ''<PreliminaryTimetables>'' 

My utility should probably go for the published one by default, but allow you to specify other ones by name.

What happens if I just run the utility as it currently stands?  No options at all.  Ah - we need a database migration.  I've a feeling that several things need setting up after that too.

Instructions are back on the [[2016:06:23|23rd of last month]].  Done all that, including the dump.  Now try it again.  It crashes in do_tutorgroups due to an attempt to find the id of a nil item.  Why have I got a nil item?  Hmm.  Seems to be struggling to create tutorgroups because it isn't setting up the staff field therein.  Why not?

Succeeded with:

* Pupils
* Staff
* Rooms

Failing on tutorgroups.  I'm fairly certain that this all worked with the previous data file.  Try it.   It works fine.

Selector is:

<SchoolManager><Forms><Form>

What then has changed in the data files, and why don't I cope with it?  Structurally, they look pretty much the same.  Presumably then we have problems with individual entries.  Add some more logging.  Several had problems with staff names, but it was 3/SJ/CEV which caused it to stop entirely.  Why?

Ah - I think the crash may just be an after-effect of failing to save some earlier.  They don't have a dbrecord and so I fail to find them.  Just need to be a bit more resilient there, then go back and find why some failed to save.  Seemed to run through this time.

Tutorgroups which fail:

RSS 5a		1036	Andrew Chim
ENFS 4a		1036	Andrew Chim
MAK 4b		41		Andrew Hall
ACC 3		895		NezeteOnen
MAK 6a		534		Nick Fieldhouse
MAK 7a		534		Nick Fieldhouse
ACC 5a		575		Peter Coke
JMG 3		596		Raj Ghosh
SJ 4b		162		David Bickerton

I think we see a pattern here - all staff who have left.  Clearly the data in iSAMS is slightly out-of-date, but why can't I find them?  I should still have their records.  They do seem to have been marked inactive at least though.  Ah - they're no longer current.  Interesting.  I wonder what the best way of handling inconsistent data like this is?  Are they still in my download file?

No they seem to have completely gone from the list of current staff.  There's the problem.  Really shouldn't have them down as owning tutor groups if they are no longer current members of staff.  Interesting that someone has marked them as gone already.

Can I ask iSAMS for ex staff too?  No - no option to do that.  OK - so the data are simply wrong in iSAMS at present.  I should not be attempting to correct it - just coping with it.  Don't attempt to load a tutor group which has no apparent tutor.


