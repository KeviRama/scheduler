Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2016-06-26T06:26:00+01:00

====== Sunday 26 Jun 2016 ======

Written a brief method to purge all events from a given event source after a specified date up until the end of the current era.  By that means I've got rid of all the SchoolBase events in Scheduler after today.

Now need to give the schedule objects the ability to load themselves into my d/b.

N.B.  Whatever loading method is used, you can't have two events with the same identifier (source_hash) on the same day.

Actually got some events in, although there are some seriously crossed threads.

* No lesson has a member of staff
* Two lessons in the same place at the same time
* Lesson name doesn't match the group attached to it

Let's pick an individual entry from the input file and follow it through.  Actually - before I do that it would make sense to check that the program is idempotent - make sure it isn't changing anything if run a second time.  Seems to be OK.  OK - pick a timetable slot.  We are just starting week A, so ideally one in week A.

How about this:

'''
<Schedule Id="6603">
  <Code>7R Sp</Code>
  <Teacher>SophiePayne44817446459904</Teacher>
  <PeriodId>2</PeriodId>
  <RoomId>19</RoomId>
  <Complete>1</Complete>
  <SetId>1</SetId>
</Schedule>
'''


That seems it should be in week A, and I do have an event of that name in my d/b.  However the set which it involves is S3 Gg1, and it's in B3.  Follow through the indicators.

Period Id of 2, puts us in Senior Week A, Monday, 09:00 to 09:50.  All good so far.
Room Id of 19, puts us in B3.  Also good.
Set Id of 1.  Ah - just realised - everything has a set id of 1.  Clearly not a useful field.

This may not be iSAMS's fault - it may be the way that Oliver has loaded the timetable.  Set 1 is S3 Gg1.  Can I find a pupil in S3 Gg1.  Yes indeed - Oliver Botting, and he does have a lot on.  Try his timetable in iSAMS.  He doesn't have a timetable in iSAMS.

Hmmm.  It appears that none of the lessons in the timetable currently has a set attached.  The API fails miserably to cope with this, and instead passes a set number of 1.  Yuk!

I can see what's wrong with the teachers though - I need to index by that long string.  Done.

And I know why we have two lessons in the same room too - it's because we moved anything from the Greening wing or Little School into randomly selected science classrooms.  Excellent.  I think I'll put this on my demo system.
